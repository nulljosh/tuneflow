#!/bin/bash
# Auto-generate project mind map

PROJECT_DIR="${1:-.}"
cd "$PROJECT_DIR" || exit 1

# Detect project type
if [ -f "package.json" ]; then
  TYPE="node"
  if grep -q "react" package.json 2>/dev/null; then
    TYPE="react"
  fi
elif [ -f "Makefile" ] && [ -d "src" ]; then
  TYPE="c-project"
elif [ -f "_config.yml" ] && [ -d "_posts" ]; then
  TYPE="jekyll"
else
  TYPE="generic"
fi

echo "Detected project type: $TYPE"

# Generate appropriate map
TEMPLATE_DIR="$HOME/.openclaw/workspace/skills/project-mapper/templates"

case $TYPE in
  jekyll)
    cat > map.svg <<'EOF'
<svg width="700" height="400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill: #1a1a1a; stroke: #4a4a4a; stroke-width: 2; }
      .text { fill: #e0e0e0; font-family: monospace; font-size: 14px; }
      .title { fill: #fff; font-size: 18px; font-weight: bold; }
      .arrow { stroke: #6b6b6b; stroke-width: 2; fill: none; }
    </style>
  </defs>
  
  <text x="350" y="30" class="title" text-anchor="middle">Jekyll Architecture</text>
  
  <rect x="250" y="60" width="200" height="60" class="box" rx="5"/>
  <text x="350" y="85" class="text" text-anchor="middle" font-weight="bold">Jekyll Static Site</text>
  <text x="350" y="105" class="text" text-anchor="middle" font-size="12">Markdown → HTML</text>
  
  <rect x="50" y="160" width="150" height="50" class="box" rx="5"/>
  <text x="125" y="180" class="text" text-anchor="middle">_posts/</text>
  <text x="125" y="197" class="text" text-anchor="middle" font-size="11">Markdown files</text>
  <path d="M 200 185 L 250 90" class="arrow"/>
  
  <rect x="275" y="160" width="150" height="50" class="box" rx="5"/>
  <text x="350" y="180" class="text" text-anchor="middle">_config.yml</text>
  <text x="350" y="197" class="text" text-anchor="middle" font-size="11">Site settings</text>
  <path d="M 350 160 L 350 120" class="arrow"/>
  
  <rect x="500" y="160" width="150" height="50" class="box" rx="5"/>
  <text x="575" y="180" class="text" text-anchor="middle">Theme</text>
  <text x="575" y="197" class="text" text-anchor="middle" font-size="11">Styling</text>
  <path d="M 500 185 L 450 90" class="arrow"/>
  
  <rect x="250" y="250" width="200" height="60" class="box" rx="5"/>
  <text x="350" y="275" class="text" text-anchor="middle" font-weight="bold">GitHub Pages</text>
  <text x="350" y="295" class="text" text-anchor="middle" font-size="11">Auto-deploy</text>
  <path d="M 350 250 L 350 210" class="arrow"/>
  
  <rect x="250" y="340" width="200" height="40" class="box" rx="5" fill="#2d5016"/>
  <text x="350" y="365" class="text" text-anchor="middle">Live URL</text>
  <path d="M 350 340 L 350 310" class="arrow"/>
</svg>
EOF
    ;;
  
  *)
    echo "No template for $TYPE yet - using generic"
    ;;
esac

echo "✓ Generated map.svg"
